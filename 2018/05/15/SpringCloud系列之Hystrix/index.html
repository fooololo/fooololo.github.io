<!DOCTYPE html><html lang="en"><head><link rel="manifest" href="/manifest.json"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="胡萝虎的个人博客"><meta name="keywords" content="Hystrix,Dashboard,Spring Cloud,胡萝虎,coding,github,"><meta name="theme-color" content="#600090"><meta name="msapplication-navbutton-color" content="#600090"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#600090"><meta name="google-site-verification" content="Fopvra9wVSD0vPGoK0_S3WC-WOIXGozNTIGw9u9fUwE"><link rel="shortcut icon" href="/favicon.ico"><link rel="alternate" type="application/atom+xml" title="胡萝虎" href="/atom.xml"><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.2/animate.min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.css"><link rel="apple-touch-icon" href="/img/touch/avatar_220.jpeg"><link rel="apple-touch-icon" href="/img/touch/avatar_220.jpeg"><title>SpringCloud系列之Hystrix｜胡萝虎的博客</title><link rel="canonical" href="https://huluohu.com/2018/05/15/SpringCloud系列之Hystrix/"><link rel="stylesheet" href="/css/bootstrap.min.css"><link rel="stylesheet" href="/css/blog-style.css"><link rel="stylesheet" href="/css/syntax.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.5.1/katex.min.css"><meta name="generator" content="Hexo 5.3.0"></head><style>header.intro-header{background-image:url(/img/avatarbg.jpg)}</style><body ontouchstart="" class="animated fadeIn"><nav class="navbar navbar-default navbar-custom navbar-fixed-top" id="nav-top" data-ispost="true" data-istags="false
" data-ishome="false"><div class="container-fluid"><div class="navbar-header page-scroll"><button type="button" class="navbar-toggle"><span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span></button> <a class="navbar-brand animated pulse" href="/"><span class="brand-logo">胡萝虎 </span>Blog</a></div><div id="huxblog_navbar"><div class="navbar-collapse"><ul class="nav navbar-nav navbar-right"><li><a href="/">Home</a></li><li><a href="/archive/">archive</a></li><li><a href="/tags/">tags</a></li><li><a href="/about">About</a></li></ul></div></div></div></nav><script>var $toggle=document.querySelector(".navbar-toggle"),$navbar=document.querySelector("#huxblog_navbar"),$collapse=document.querySelector(".navbar-collapse");function handleMagic(e){0<$navbar.className.indexOf("in")?($navbar.className=" ",setTimeout(function(){$navbar.className.indexOf("in")<0&&($collapse.style.height="0px")},400)):($collapse.style.height="auto",$navbar.className+=" in")}$toggle.addEventListener("click",handleMagic)</script><img class="wechat-title-img" src="undefinedblog/hystrix01.jpg"><style>header.intro-header{background-image:url(undefinedblog/hystrix01.jpg?imageView2/1/w/1400/h/400/interlace/1/q/90)}</style><header class="intro-header"><div class="container"><div class="row"><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1 text-center"><div class="post-heading"><h1>SpringCloud系列之Hystrix</h1><span class="meta">作者 胡萝虎 <span>日期 2018-05-15</span></span><div class="tags text-center"><a class="tag" href="/tags/#Spring Cloud" title="Spring Cloud">Spring Cloud</a> <a class="tag" href="/tags/#Spring Boot" title="Spring Boot">Spring Boot</a> <a class="tag" href="/tags/#Spring" title="Spring">Spring</a> <a class="tag" href="/tags/#微服务" title="微服务">微服务</a> <a class="tag" href="/tags/#Feign" title="Feign">Feign</a> <a class="tag" href="/tags/#Hystrix" title="Hystrix">Hystrix</a></div></div></div></div></div><div class="post-title-haojen"><span>SpringCloud系列之Hystrix</span></div></header><article><div class="container"><div class="row"><div class="col-lg-8 col-lg-offset-1 col-sm-9 post-container"><blockquote><p>在分布式系统中，如果服务提供者响应缓慢，会导致消费者请求等待，直到收到响应或超时。如果在高并发、高负载的场景下，会导致消费者大量线程等待服务提供者响应，持续下去的话很容易导致整个系统因为资源耗尽而崩溃。比如，电影服务作为上层的消费者，需要从下层的用户服务查询用户信息，这时候用户服务因为某些原因导致响应非常缓慢，正常只需要10毫秒的响应被延长到几十秒。电影服务持续不断收到外部请求，并等待用户服务响应，很快，电影服务自身也崩溃了。</p><p>因为依赖的服务不可用或不稳定时，导致自身被拖垮，分布式系统中时常会上演，这种情况也被称为“雪崩效应”。</p></blockquote><p>那么，该如何防止雪崩效应呢？一般需要做两点：</p><ul><li>设置网络请求超时时间，尽快释放系统资源，减少不必要的等待</li><li>使用熔断器，为系统安装过载保护功能</li></ul><p>下面我们要介绍的Hystrix就是熔断器的一个实现。</p><h2 id="Hystrix"><a href="#Hystrix" class="headerlink" title="Hystrix"></a>Hystrix</h2><p>Hystrix时Netflix开发的一个容错库，用于隔离远程调用，防止引发级联失败，避免雪崩效应。它类似于电路中的断路器，当系统超过了容忍的错误限度时，开启断路保护，阻止错误放大，从而提升系统的稳定性和容错性。</p><p>Hystrix主要提供以下功能：</p><ul><li>代理请求，即使用HystrixCommand代理调用逻辑</li><li>跳闸保护，当某个依赖服务错误率达到设定的阀值，可以自动或手动开启跳闸，阻止继续请求依赖的服务</li><li>资源隔离，将依赖的服务放到单独的线程池中执行，避免过度资源占有和应用其他模块</li><li>回退机制，即在请求失败、超时、被拒绝等场景下，多断路器打开状态下，执行回退逻辑（快速失败），开发者自定义回退逻辑</li><li>自我修复，即断路器打开一段时间后会自动进入“半开”状态，并测试依赖的服务是否已经恢复，如果恢复，则将断路器关闭，即自动管理断路器的开启、半开和关闭状态</li></ul><h2 id="实战"><a href="#实战" class="headerlink" title="实战"></a>实战</h2><h3 id="修改用户服务"><a href="#修改用户服务" class="headerlink" title="修改用户服务"></a>修改用户服务</h3><ul><li><p>服务provider-user，并改名为provider-user-hystrix</p><p><img src="/images/loading.gif" data-original="https://tva1.sinaimg.cn/large/006tKfTcly1frbvy2q4szj30jc0ne409.jpg" alt="image-20180515113118929"></p></li><li><p>修改用户服务代码</p><p>将findById方法修改成 i&gt;=3时，抛出异常。</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.huluohu.cloud.user.presentation.web;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.huluohu.cloud.user.presentation.mode.UserDTO;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.atomic.AtomicInteger;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Random random = <span class="keyword">new</span> Random();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> AtomicInteger counter = <span class="keyword">new</span> AtomicInteger();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询用户</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> UserDTO <span class="title">findById</span><span class="params">(<span class="meta">@PathVariable</span> Integer id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span> i = counter.incrementAndGet();</span><br><span class="line">        log.info(<span class="string">&quot;i=========&#123;&#125;&quot;</span>, i);</span><br><span class="line">        <span class="keyword">if</span> (i &gt;= <span class="number">3</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">&quot;测试断路器&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> UserDTO.builder()</span><br><span class="line">                .id(id)</span><br><span class="line">                .username(<span class="string">&quot;root_&quot;</span> + id)</span><br><span class="line">                .name(<span class="string">&quot;huluohu_&quot;</span> + id)</span><br><span class="line">                .age(random.nextInt(<span class="number">30</span>) % (<span class="number">30</span> - <span class="number">15</span> + <span class="number">1</span>) + <span class="number">15</span>)</span><br><span class="line">                .balance(random.nextLong())</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;   </span><br></pre></td></tr></table></figure><h3 id="修改电影服务"><a href="#修改电影服务" class="headerlink" title="修改电影服务"></a>修改电影服务</h3></li><li><p>复制consumer-movie-feign，并改名为consumer-movie-hystrix</p><p><img src="/images/loading.gif" data-original="https://tva1.sinaimg.cn/large/006tKfTcly1frbvy1c0vhj30ja0sw40o.jpg" alt="image-20180515113450657"></p></li><li><p>添加依赖</p><p>pom.xml中增加以下hystrix的依赖</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-hystrix<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>修改配置</p><p>在application-local.yml中增加hystrix配置</p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">feign:</span></span><br><span class="line">  <span class="attr">hystrix:</span></span><br><span class="line">   <span class="attr">enabled:</span> <span class="literal">true</span> <span class="comment">#开启hystrix</span></span><br></pre></td></tr></table></figure></li><li><p>修改启动类</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.huluohu.cloud.movie;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.discovery.EnableDiscoveryClient;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.netflix.feign.EnableFeignClients;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.netflix.hystrix.EnableHystrix;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="meta">@EnableFeignClients</span></span><br><span class="line"><span class="meta">@EnableHystrix</span> <span class="comment">//开启hystrix</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MovieApplication</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(MovieApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>添加回退逻辑代码</p><p>创建回退逻辑类，该类型需要实现<code>UserServiceClient</code>并增加<code>@Component</code>注解</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.huluohu.cloud.movie.application.client.hystrix;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.huluohu.cloud.movie.application.client.UserServiceClient;</span><br><span class="line"><span class="keyword">import</span> com.huluohu.cloud.movie.application.model.User;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceClientHystrix</span> <span class="keyword">implements</span> <span class="title">UserServiceClient</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">findById</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> User.builder()</span><br><span class="line">                .username(<span class="string">&quot;random&quot;</span>)</span><br><span class="line">                .name(<span class="string">&quot;default&quot;</span>)</span><br><span class="line">                .age(<span class="number">0</span>)</span><br><span class="line">                .balance(<span class="number">0L</span>)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>设置回退逻辑类型</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.huluohu.cloud.movie.application.client;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.huluohu.cloud.movie.application.client.hystrix.UserServiceClientHystrix;</span><br><span class="line"><span class="keyword">import</span> com.huluohu.cloud.movie.application.model.User;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.netflix.feign.FeignClient;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"></span><br><span class="line"><span class="meta">@FeignClient(serviceId = &quot;provider-user&quot;,fallback = UserServiceClientHystrix.class)</span><span class="comment">//设置回退逻辑类</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserServiceClient</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据ID查询User</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/user/&#123;id&#125;&quot;, method = RequestMethod.GET)</span></span><br><span class="line">    <span class="function">User <span class="title">findById</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ul><h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><ol><li>启动Eureka Server(local profile)</li><li>启动Config Server(不需要区分profile)</li><li>启动provider-user-hystrix(local profile)</li><li>启动consumer-movie-hystrix(local profile)</li></ol><ul><li><p>启动服务列表</p><p><img src="/images/loading.gif" data-original="https://tva1.sinaimg.cn/large/006tKfTcly1frbvy0bhpyj30mo06kgma.jpg" alt="image-20180515114648649"></p></li><li><p>服务注册情况</p><p><img src="/images/loading.gif" data-original="https://tva1.sinaimg.cn/large/006tKfTcly1frbvxzy0lvj31kw08utb2.jpg" alt="image-20180515114702291"></p></li><li><p>测试</p><ul><li><p>使用浏览器或Postman访问<code>http://localhost:9009/test/user/1</code>3次，正常返回用户服务的结果</p><p><img src="/images/loading.gif" data-original="https://tva1.sinaimg.cn/large/006tKfTcly1frbvy3b3k8j31kw0mgadx.jpg" alt="image-20180515114906873"></p><p>此时，hystrix状态正常，断路器没有打开：</p><p><img src="/images/loading.gif" data-original="https://tva1.sinaimg.cn/large/006tKfTcly1frbvy1w30hj30v016qtde.jpg" alt="image-20180515115108217"></p></li><li><p>使用Postman Runner快速请求<code>http://localhost:9009/test/user/1</code></p><p><img src="/images/loading.gif" data-original="https://tva1.sinaimg.cn/large/006tKfTcly1frbvy0v2y8j30qm156wgi.jpg" alt="image-20180515115157297"></p><p>每次返回的结果都是默认值：</p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;id&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">&quot;username&quot;</span>: <span class="string">&quot;random&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;default&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;age&quot;</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">&quot;balance&quot;</span>: <span class="number">0</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>此时，hystrix的断路器是打开的：</p><p><img src="/images/loading.gif" data-original="https://tva1.sinaimg.cn/large/006tKfTcly1frbvxzdtzqj30wg16ijwa.jpg" alt="image-20180515115430860"></p></li></ul></li></ul><h2 id="Hystrix监控"><a href="#Hystrix监控" class="headerlink" title="Hystrix监控"></a>Hystrix监控</h2><p>除了提供熔断功能外，Hystrix还提供了实时监控模块，可以对断路器的运行状态和指标进行监控。</p><h3 id="查看Hystrix状态"><a href="#查看Hystrix状态" class="headerlink" title="查看Hystrix状态"></a>查看Hystrix状态</h3><p>在上面的例子中，consumer-movie-hystrix已经整合了Feign和Hystrix，并添加了<code>spring-boot-starter-actuator</code>依赖，可以在浏览器中请求<code>http://localhost:9009/hystrix.stream</code>，查看监控情况：</p><p><img src="/images/loading.gif" data-original="https://tva1.sinaimg.cn/large/006tNc79ly1frd1jg509bj31kw0poe81.jpg" alt="image-20180516113722747"></p><p>Hystrix使用hystrix-metrics-event-stream模块实现将监控指标以text/evanet-stream格式输出。</p><h3 id="整合Dashboard"><a href="#整合Dashboard" class="headerlink" title="整合Dashboard"></a>整合Dashboard</h3><p>直接访问<code>http://localhost:9009/hystrix.stream</code>返回的数据不太直观，我们可以通过整合Hystrix Dashboard，让数据可视化。</p><h4 id="创建Maven项目"><a href="#创建Maven项目" class="headerlink" title="创建Maven项目"></a>创建Maven项目</h4><p><img src="/images/loading.gif" data-original="https://tva1.sinaimg.cn/large/006tNc79ly1frd1jcbwelj30jo0h2wft.jpg" alt="image-20180516114225734"></p><h4 id="添加依赖"><a href="#添加依赖" class="headerlink" title="添加依赖"></a>添加依赖</h4><p>pom.xml添加dashboard依赖</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-hystrix-dashboard<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="添加配置"><a href="#添加配置" class="headerlink" title="添加配置"></a>添加配置</h4><p>application.yml配置</p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">hystrix-dashboard</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="attr">management:</span></span><br><span class="line">  <span class="attr">security:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">7777</span></span><br></pre></td></tr></table></figure><h4 id="创建启动类"><a href="#创建启动类" class="headerlink" title="创建启动类"></a>创建启动类</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.huluohu.cloud.hystrix;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.netflix.hystrix.dashboard.EnableHystrixDashboard;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableHystrixDashboard</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HystrixDashboardApplication</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(HystrixDashboardApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="测试-1"><a href="#测试-1" class="headerlink" title="测试"></a>测试</h4><ol><li>启动Eureka Server(local profile)</li><li>启动Config Server(不需要区分profile)</li><li>启动provider-user-hystrix(local profile)</li><li>启动consumer-movie-hystrix(local profile)</li><li>启动hystrix-dashboard（不区分profile）</li></ol><ul><li><p>应用列表</p><p><img src="/images/loading.gif" data-original="https://tva1.sinaimg.cn/large/006tNc79ly1frd1jdn8d9j30jy06e3z8.jpg" alt="image-20180516114519527"></p></li><li><p>浏览器中打开<code>http://localhost:7777/hystrix</code></p><p><img src="/images/loading.gif" data-original="https://tva1.sinaimg.cn/large/006tNc79ly1frd1jh820rj31kw0nxqaz.jpg" alt="image-20180516114705407"></p></li><li><p>在上面图中url输入框中输入<code>http://localhost:9009/hystrix.stream</code>,Title输入框随意输入一个名字，然后点击<code>Monitor Stream</code>按钮</p><p><img src="/images/loading.gif" data-original="https://tva1.sinaimg.cn/large/006tNc79ly1frd1ji3c3qj31ca0vcafh.jpg" alt="image-20180516114909908"></p></li></ul><p>到达监控页面，此时没用请求，监控数据都是初始值。</p><p><img src="/images/loading.gif" data-original="https://tva1.sinaimg.cn/large/006tNc79ly1frd1mou7lwj31kw0fn42k.jpg" alt="image-20180516115748805"></p><ul><li><p>在Postman上执行查询用户接口测试，在查看监控页面</p><p><img src="/images/loading.gif" data-original="https://tva1.sinaimg.cn/large/006tNc79ly1frd1jjhq7wj31kw0xtjvh.jpg" alt="image-20180516115224242"></p></li></ul><p><img src="/images/loading.gif" data-original="https://tva1.sinaimg.cn/large/006tNc79ly1frd1jcw01xj31kw0gc0xc.jpg" alt="image-20180516115321177"></p><p>怎么样，很简单吧！</p><div style="width:100%;height:30px;line-height:30px;text-align:center;background:#f5f5f5"><span>没有更多了^ - ^</span></div><div style="width:100%;height:340px;text-align:center"></div><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAKQAAACkCAAAAAA83tqdAAACbElEQVR42u2awW7DMAxD+/8/nV22oQti8TEpdjCZSzEjUZ6HSqUov17DdXxf57/f19S1ev5n3Y1XyAzI4+K6glrd527oPd75cxW/kHmQU5BVErhJuNoAeV8hC6nWp2Q7JxKJU8hCOpAoyHDfqtg7iVrIPMgpCVQBXgnYSYx8VAUVcjtIJQr+6/N2t1jIrSAPcU2Fd0oKZQiQd/8+U8goyOmLqworFbNXIoMYVoXMhCQAKqASD1MCoiJfyDhI9WUnSaQK+ZS5UiwXMgrSmemQxKAF/MkGC7k/JB1ITsMl0lAp8SxVUCEjIJXJPhXcCfyO4Y9cikJGQFIQVXBR1ycK/GUyFjISkppJdwQJESFjvEJGQTrC1TnYRAafKnEKmQkpDXVnt6DRJ8N4NJAv5NaQRAzQQT1JJrq5PwKjkLGQ7uDo7gDVOTBSyCxIZVIpYHco726okJmQVBgosfDEZEBmbCEjIKlZr15AjAFHBC9/cQoZBakMUmJaOev0/GYhcyFVE0buJwlDmzaU3YXcElKJTzWXnJ5zhO1SPBcyClKBTkXXEchqzo7NgUJGQSoxS8TtJ8x/fEK6kNtCPjEIqHClwkI1hoXMgSRBlOvlJJ8rmguZBakMJNfQcpNLDRMKmQupTCbqs5NDyApwFL2FjIIkxVgNiCY4MnC1prSF3A7yjmCV01TY8JPNIPVdyK0gaXapQKjTM0UKAi3klpBPzX1ykImaC4UspGrq1RopxGS4JP8JhSwkPPhGh/bEeJAnUQtZyEOfEEUH4sDwUzaAhYyDdH74SbF/MqTHHWMht4WkglY9TE1SFc8ytgq5G+QXMQvt7dKW6SgAAAAASUVORK5CYII="><div style="width:100%;text-align:center"><span style="font-size:20px">“扫一扫接着看”</span></div><ul class="pager"><li class="previous"><a href="/2018/05/16/SpringCloud系列之Turbine/" data-toggle="tooltip" data-placement="top" title="SpringCloud系列之Turbine">&larr; Previous Post</a></li><li class="next"><a href="/2018/05/14/SpringCloud系列之Feign/" data-toggle="tooltip" data-placement="top" title="SpringCloud系列之Feign">Next Post &rarr;</a></li></ul><div id="lv-container" data-id="city" data-uid="MTAyMC8zNTY2My8xMjE5OQ=="><script type="text/javascript">!function(e,t){var n=e.getElementsByTagName(t)[0];"function"!=typeof LivereTower&&((t=e.createElement(t)).src="https://cdn-city.livere.com/js/embed.dist.js",t.async=!0,n.parentNode.insertBefore(t,n))}(document,"script")</script><noscript>为正常使用来必力评论功能请激活JavaScript</noscript></div></div><div class="hidden-xs col-sm-3 toc-col"><div class="toc-wrap"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Hystrix"><span class="toc-text">Hystrix</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E6%88%98"><span class="toc-text">实战</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E7%94%A8%E6%88%B7%E6%9C%8D%E5%8A%A1"><span class="toc-text">修改用户服务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E7%94%B5%E5%BD%B1%E6%9C%8D%E5%8A%A1"><span class="toc-text">修改电影服务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95"><span class="toc-text">测试</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Hystrix%E7%9B%91%E6%8E%A7"><span class="toc-text">Hystrix监控</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8BHystrix%E7%8A%B6%E6%80%81"><span class="toc-text">查看Hystrix状态</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B4%E5%90%88Dashboard"><span class="toc-text">整合Dashboard</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BAMaven%E9%A1%B9%E7%9B%AE"><span class="toc-text">创建Maven项目</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E4%BE%9D%E8%B5%96"><span class="toc-text">添加依赖</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E9%85%8D%E7%BD%AE"><span class="toc-text">添加配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%90%AF%E5%8A%A8%E7%B1%BB"><span class="toc-text">创建启动类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95-1"><span class="toc-text">测试</span></a></li></ol></li></ol></li></ol></div></div></div><div class="row"><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1 sidebar-container"><div style="margin-top:20px"><h5 class="text-center">FRIENDS</h5><ul class="list-inline text-center"><li><a target="_blank" rel="noopener" href="https://springcloud.cc/">Spring Cloud中文网</a></li><li><a target="_blank" rel="noopener" href="http://www.spring4all.com/">Spring For All</a></li><li><a target="_blank" rel="noopener" href="https://github.com/spring-cloud">Spring Cloud</a></li></ul></div></div></div></div></article><footer><div class="container"><div class="row"><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1 text-center"><br><ul class="list-inline text-center"><li><a target="_blank" href="https://www.zhihu.com/people/huluohu"><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-stack-1x fa-inverse">知</i></span></a></li><li><a target="_blank" href="https://github.com/fooololo"><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-github fa-stack-1x fa-inverse"></i></span></a></li></ul><p class="copyright text-muted">Copyright &copy; 胡萝虎 2021 浙ICP备18019084号-1<br><span id="busuanzi_container_site_pv" style="font-size:12px">访问: <span id="busuanzi_value_site_pv"></span> 次</span> <span class="post-meta-divider">|</span> <span id="busuanzi_container_site_uv" style="font-size:12px;display:none">访客：<span id="busuanzi_value_site_uv"></span>人</span><br></p></div></div></div></footer><script src="/js/jquery.min.js"></script><script src="/js/bootstrap.min.js"></script><script src="/js/blog.js"></script><script>function async(e,n){var t=document,a="script",r=t.createElement(a),a=t.getElementsByTagName(a)[0];r.src=e,n&&r.addEventListener("load",function(e){n(null,e)},!1),a.parentNode.insertBefore(r,a)}</script><script>0!==$("#tag_cloud").length&&async("https://huluohu.com/js/jquery.tagcloud.js",function(){$.fn.tagcloud.defaults={color:{start:"#bbbbee",end:"#0085a1"}},$("#tag_cloud a").tagcloud()})</script><script>async("//cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js",function(){var c=document.querySelector("nav");c&&FastClick.attach(c)})</script><script>var _baId="a56cc9c749e8c4177e393ae19735216f",_hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="//hm.baidu.com/hm.js?"+_baId;var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><script type="text/javascript">!function(t,e,n,s,c,i){t.SwiftypeObject=s,t[s]=t[s]||function(){(t[s].q=t[s].q||[]).push(arguments)},c=e.createElement(n),i=e.getElementsByTagName(n)[0],c.async=1,c.src="//s.swiftypecdn.com/install/v2/st.js",i.parentNode.insertBefore(c,i)}(window,document,"script","_st"),_st("install","","2.0.0")</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><img class="wechat-title-img" src="/img/avatar.png"><script>"serviceWorker"in navigator&&navigator.serviceWorker.register("/sw.js?t=1610684148379").then(function(){console.log("ServiceWorker Register Successfully.")}).catch(function(e){console.error(e)})</script><script>
            window.imageLazyLoadSetting = {
                isSPA: false,
                processImages: null,
            };
        </script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(e.href.match(t)||e.href.match(r))&&(e.href=a.dataset.original)})});</script><script>!function(n){n.imageLazyLoadSetting.processImages=i;var e=n.imageLazyLoadSetting.isSPA,r=Array.prototype.slice.call(document.querySelectorAll("img[data-original]"));function i(){e&&(r=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")));for(var t,a=0;a<r.length;a++)0<=(t=(t=r[a]).getBoundingClientRect()).bottom&&0<=t.left&&t.top<=(n.innerHeight||document.documentElement.clientHeight)&&function(){var t,e,n,i,o=r[a];t=o,e=function(){r=r.filter(function(t){return o!==t})},n=new Image,i=t.getAttribute("data-original"),n.onload=function(){t.src=i,e&&e()},n.src=i}()}i(),n.addEventListener("scroll",function(){var t,e;t=i,e=n,clearTimeout(t.tId),t.tId=setTimeout(function(){t.call(e)},500)})}(this);</script></body></html>