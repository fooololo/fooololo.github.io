<!DOCTYPE html><html lang="en"><head><link rel="manifest" href="/manifest.json"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="胡萝虎的个人博客"><meta name="keywords" content="Zuul,Spring Cloud,Filter,胡萝虎,coding,github,"><meta name="theme-color" content="#600090"><meta name="msapplication-navbutton-color" content="#600090"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#600090"><meta name="google-site-verification" content="Fopvra9wVSD0vPGoK0_S3WC-WOIXGozNTIGw9u9fUwE"><link rel="shortcut icon" href="/favicon.ico"><link rel="alternate" type="application/atom+xml" title="胡萝虎" href="/atom.xml"><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.2/animate.min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.css"><link rel="apple-touch-icon" href="/img/touch/avatar_220.jpeg"><link rel="apple-touch-icon" href="/img/touch/avatar_220.jpeg"><title>SpringCloud系列之Zuul自定义｜胡萝虎的博客</title><link rel="canonical" href="https://huluohu.com/2018/05/25/SpringCloud系列之Zuul自定义/"><link rel="stylesheet" href="/css/bootstrap.min.css"><link rel="stylesheet" href="/css/blog-style.css"><link rel="stylesheet" href="/css/syntax.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.5.1/katex.min.css"><meta name="generator" content="Hexo 5.3.0"></head><style>header.intro-header{background-image:url(/img/avatarbg.jpg)}</style><body ontouchstart="" class="animated fadeIn"><nav class="navbar navbar-default navbar-custom navbar-fixed-top" id="nav-top" data-ispost="true" data-istags="false
" data-ishome="false"><div class="container-fluid"><div class="navbar-header page-scroll"><button type="button" class="navbar-toggle"><span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span></button> <a class="navbar-brand animated pulse" href="/"><span class="brand-logo">胡萝虎 </span>Blog</a></div><div id="huxblog_navbar"><div class="navbar-collapse"><ul class="nav navbar-nav navbar-right"><li><a href="/">Home</a></li><li><a href="/archive/">archive</a></li><li><a href="/tags/">tags</a></li><li><a href="/about">About</a></li></ul></div></div></div></nav><script>var $toggle=document.querySelector(".navbar-toggle"),$navbar=document.querySelector("#huxblog_navbar"),$collapse=document.querySelector(".navbar-collapse");function handleMagic(e){0<$navbar.className.indexOf("in")?($navbar.className=" ",setTimeout(function(){$navbar.className.indexOf("in")<0&&($collapse.style.height="0px")},400)):($collapse.style.height="auto",$navbar.className+=" in")}$toggle.addEventListener("click",handleMagic)</script><img class="wechat-title-img" src="/img/post/zuul02.jpg"><style>header.intro-header{background-image:url(/img/post/zuul02.jpg)}</style><header class="intro-header"><div class="container"><div class="row"><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1 text-center"><div class="post-heading"><h1>SpringCloud系列之Zuul自定义</h1><span class="meta">作者 胡萝虎 <span>日期 2018-05-25</span></span><div class="tags text-center"><a class="tag" href="/tags/#Spring Cloud" title="Spring Cloud">Spring Cloud</a> <a class="tag" href="/tags/#Spring Boot" title="Spring Boot">Spring Boot</a> <a class="tag" href="/tags/#Spring" title="Spring">Spring</a> <a class="tag" href="/tags/#微服务" title="微服务">微服务</a> <a class="tag" href="/tags/#Zuul" title="Zuul">Zuul</a> <a class="tag" href="/tags/#Filter" title="Filter">Filter</a></div></div></div></div></div><div class="post-title-haojen"><span>SpringCloud系列之Zuul自定义</span></div></header><article><div class="container"><div class="row"><div class="col-lg-8 col-lg-offset-1 col-sm-9 post-container"><blockquote><p>在<a target="_blank" rel="noopener" href="https://blog.huluohu.com/2018/05/22/1526976000/">SpringCloud系列之Zuul</a>中我们介绍了Zuul与Spring Cloud整合的应用以及简单配置。Zuul是基于Filter的，通过组合不同的Filter可以实现不同的功能，Spring Cloud整合Zuul后也提供了一些默认的FIlter，如DebugFilter、FormBodyWrapPreFilter、PreDecorationFilter等。实际上，我们也可以编写自己的Filter来实现相应的功能。同时，在Spring Cloud中Zuul通过整合Hystrix也可以实现容错和断路保护。</p></blockquote><h2 id="Filter"><a href="#Filter" class="headerlink" title="Filter"></a>Filter</h2><p>Filter是Zuul的核心组件，不同类型的Filter作用在一个请求的不同生命周期上，具体如下：</p><ul><li><p>PRE</p><p>此类型Filter在请求被路由之前调用。可以应用在身份认证、安全检查、负载均衡等等</p></li><li><p>ROUTING</p><p>此类型Filter实际上就是路由器，用于将请求路由到代理的服务上</p></li><li><p>POST</p><p>此类型Filter在请求被路由到服务后调用，可以用于收集性能指标、增强响应等</p></li><li><p>ERROR</p><p>此类型Filter在其他阶段发送错误时被调用，可以用于记录日志、处理错误等</p></li><li><p>自定义</p><p>除了上面默认的几种Filter，我们也可以自定义类型</p></li></ul><h3 id="自定义Filter"><a href="#自定义Filter" class="headerlink" title="自定义Filter"></a>自定义Filter</h3><p>复制gateway-zuul，改名为gateway-zuul-filter</p><p><img src="/images/loading.gif" data-original="https://tva1.sinaimg.cn/mw690/0079ftwMgy1frnfo70s2hj30oo0qcjtv.jpg"></p><h4 id="创建Filter"><a href="#创建Filter" class="headerlink" title="创建Filter"></a>创建Filter</h4><p>自定义Filter需要继承ZuulFilter抽象类</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.huluohu.cloud.gateway.infrastructure.filter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.netflix.zuul.ZuulFilter;</span><br><span class="line"><span class="keyword">import</span> com.netflix.zuul.context.RequestContext;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PreRequestLogFilter</span> <span class="keyword">extends</span> <span class="title">ZuulFilter</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">filterType</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;pre&quot;</span>; <span class="comment">//filter类型</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">filterOrder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>; <span class="comment">//执行顺序</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">shouldFilter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>; <span class="comment">//是否执行</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//具体逻辑</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> RequestContext context = RequestContext.getCurrentContext();</span><br><span class="line">        <span class="keyword">final</span> HttpServletRequest request = context.getRequest();</span><br><span class="line"></span><br><span class="line">        log.info(String.format(<span class="string">&quot;send %s request to %s&quot;</span>,request.getMethod(),request.getRequestURL().toString()));</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>创建一个类，继承<code>ZuulFilter</code></li><li>设置Filter类型、执行顺序和是否执行</li><li>编写具体业务逻辑（打印请求日志）</li></ul><h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><p>在Configuration类中配置自定义Filter</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.huluohu.cloud.gateway;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.huluohu.cloud.gateway.infrastructure.filter.PreRequestLogFilter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ApplicationConfiguration</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> PreRequestLogFilter <span class="title">preRequestLogFilter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> PreRequestLogFilter();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><ol><li>启动Eureka Server(local profile)</li><li>启动Config Server(不需要区分profile)</li><li>启动provider-user(local profile)</li><li>启动consumer-movie-hystrix-mq(local profile)</li><li>启动gateway-zuul-filter(local profile)</li></ol><ul><li><p>启动应用列表</p><p><img src="/images/loading.gif" data-original="https://tva1.sinaimg.cn/mw690/0079ftwMly1frnfphrudlj30mi06eq3v.jpg"></p></li></ul><ul><li><p>在浏览器中请求<code>http://localhost:6999/movie/test/user/1</code></p><p><img src="/images/loading.gif" data-original="https://tva1.sinaimg.cn/mw690/0079ftwMly1frnfqj250tj31dm07adjf.jpg"></p><p>可以看到控制台打印了日志</p></li></ul><h2 id="容错与断路保护"><a href="#容错与断路保护" class="headerlink" title="容错与断路保护"></a>容错与断路保护</h2><p>Zuul默认集成了Hystrix，支持容错和断路保护，所以也可以通过Turbine对Hystrix监控数据进行聚合。</p><p>Zuul中的Hystrix监控不同于普通服务的监控，它的粒度是服务级别的，而不是API级别。</p><p><img src="/images/loading.gif" data-original="https://tva1.sinaimg.cn/mw690/0079ftwMly1frnfrc3xiuj32700n0ag3.jpg"></p><p>在Zuul中，回退逻辑需要进行自定义，即实现类实现<code>FallbackProvider</code>接口</p><h3 id="自定义回退逻辑"><a href="#自定义回退逻辑" class="headerlink" title="自定义回退逻辑"></a>自定义回退逻辑</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.huluohu.cloud.gateway.infrastructure.fallback;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.netflix.zuul.filters.route.FallbackProvider;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.HttpHeaders;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.HttpStatus;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.MediaType;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.client.ClientHttpResponse;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.ByteArrayInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.nio.charset.Charset;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MovieServiceFallbackProvider</span> <span class="keyword">implements</span> <span class="title">FallbackProvider</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ClientHttpResponse <span class="title">fallbackResponse</span><span class="params">(Throwable cause)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> MovieFallbackResponse(cause.getLocalizedMessage());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getRoute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;consumer-movie&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ClientHttpResponse <span class="title">fallbackResponse</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> MovieFallbackResponse(<span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">MovieFallbackResponse</span> <span class="keyword">implements</span> <span class="title">ClientHttpResponse</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> String cause;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">MovieFallbackResponse</span><span class="params">(String cause)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.cause = cause;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> HttpStatus <span class="title">getStatusCode</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> HttpStatus.OK;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getRawStatusCode</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> HttpStatus.OK.value();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">getStatusText</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> HttpStatus.OK.getReasonPhrase();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> InputStream <span class="title">getBody</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">            <span class="keyword">final</span> StringBuilder builder = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">            builder.append(<span class="string">&quot;Movie 服务不可用&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span> (StringUtils.isNotBlank(<span class="keyword">this</span>.cause)) &#123;</span><br><span class="line">                builder.append(<span class="string">&quot;(&quot;</span> + cause + <span class="string">&quot;)&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            builder.append(<span class="string">&quot;，请稍后再试。&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> ByteArrayInputStream(builder.toString().getBytes());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> HttpHeaders <span class="title">getHeaders</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">final</span> HttpHeaders headers = <span class="keyword">new</span> HttpHeaders();</span><br><span class="line">            <span class="keyword">final</span> MediaType mediaType = <span class="keyword">new</span> MediaType(<span class="string">&quot;application&quot;</span>, <span class="string">&quot;json&quot;</span>, Charset.forName(<span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">            headers.setContentType(mediaType);</span><br><span class="line">            <span class="keyword">return</span> headers;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="测试-1"><a href="#测试-1" class="headerlink" title="测试"></a>测试</h3><ul><li><p>关闭consumer-movie-hystrix-mq</p></li><li><p>浏览器中请求<code>http://localhost:6999/movie/test/user/1</code></p><ul><li>错误响应1</li></ul><p><img src="/images/loading.gif" data-original="https://tva1.sinaimg.cn/mw690/0079ftwMly1frnfrstqgbj30uw07ugmd.jpg"></p><ul><li>错误响应2</li></ul><p><img src="/images/loading.gif" data-original="https://tva1.sinaimg.cn/mw690/0079ftwMly1frnfsdvh6qj3180084gmp.jpg"></p></li><li><p>多次请求zuul，此时可以看到Hystrix监控到了失败情况（失败数量、断路器开启）</p><p><img src="/images/loading.gif" data-original="https://tva1.sinaimg.cn/mw690/0079ftwMly1frnft59tlxj32660lmdlw.jpg"></p></li></ul><div style="width:100%;height:30px;line-height:30px;text-align:center;background:#f5f5f5"><span>没有更多了^ - ^</span></div><div style="width:100%;height:340px;text-align:center"></div><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALQAAAC0CAAAAAAYplnuAAADAUlEQVR42u2bQY7bQAwE/f9Pb3LIwVkN2dVjBDls6WJbkkclATTJZvv1Wrav39vp/fvn99dp+378fY3p3NftJrTQ4MsJZLvhDXy71nZdoYUm0OSC077p/RZgp4Dc1n98FlroS+jp+DE4ADQJMqGF/pfQKZBIojkdp4lJaKFvoVPhThNOKvhJYH9c5Qn946FTY/u/Xj/qxoX+sdBfYZsSARVhUjKhjfRfawot9M6EhMYpiUyQRKykD+QYnEILHTRrAkDF76bwIfvGZCO00KEWoQFDEtAUtE2xhop/oYUeEguBIjdGE1MS1rd9QgtNoenwJx2jQg4d+j/WEVroAE0X2oTDtO9mrbF4ElrooramSWBavNnXGrOEFppAp0FnI8Rsg1KagFCSE1rovQZCQ/RkJLlNFlvjW3fiQgt9aUxpBJ0mQZGHILTQCZoINNPCZNBDmoAkVD4ehNBCl9DETJWOfWLkqgoloYUOA31qxEpNKW1wyTBpVU6FFvrwO90Ii8kgRQLzRsR8dONCCz3XIS8imNBGIRldU3NBzxFa6FQwJdGxMaA0Zqrm+qs5Vmihyz84EFNrVaWBRHJT8wstNBm8pwFmEsVj4dMmNKGFBtBEhEGVFxDUt4E9Ok9ooSF0Y/JrhvgJYoPHqpHQQheNLTlGIdqmOTa4Qgt9eN8YXJuB/K0hFplohBaa6YOvNIRsBv3Ng0iBH7tyoYVekstW/NBEkqCIaSsWUkILPUA3ggsxnUzf36DTzTzghRYaQDegqaChgx5icIkTLqGFPniYiAmFDDtpgqGF1vGGhRY6QG/BQRYkAiMV0ZFBV2ihg1fvpoCnSSc1uY1B9qEwCS308Mfg1Ki2gmSTkFLzPA4/hRY6/74jw1RanARtW2htjbPQQp+gtwCkgUICkyQYbNgSWugATQytKZqbKo2YYNZ1hRb6Epo0tVtiIUFKvFXjoEhooT+Apqaq1mxChqKrs0ZooYt6OhYuwXBFzyGmlXUaILTQhSE8DXiooSUJl9s5SeQUWug/2y8ODxVTp478OgAAAABJRU5ErkJggg=="><div style="width:100%;text-align:center"><span style="font-size:20px">“扫一扫接着看”</span></div><ul class="pager"><li class="next"><a href="/2018/05/22/SpringCloud系列之Zuul/" data-toggle="tooltip" data-placement="top" title="SpringCloud系列之Zuul">Next Post &rarr;</a></li></ul><div id="lv-container" data-id="city" data-uid="MTAyMC8zNTY2My8xMjE5OQ=="><script type="text/javascript">!function(e,t){var n=e.getElementsByTagName(t)[0];"function"!=typeof LivereTower&&((t=e.createElement(t)).src="https://cdn-city.livere.com/js/embed.dist.js",t.async=!0,n.parentNode.insertBefore(t,n))}(document,"script")</script><noscript>为正常使用来必力评论功能请激活JavaScript</noscript></div></div><div class="hidden-xs col-sm-3 toc-col"><div class="toc-wrap"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Filter"><span class="toc-text">Filter</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89Filter"><span class="toc-text">自定义Filter</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BAFilter"><span class="toc-text">创建Filter</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE"><span class="toc-text">配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95"><span class="toc-text">测试</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%B9%E9%94%99%E4%B8%8E%E6%96%AD%E8%B7%AF%E4%BF%9D%E6%8A%A4"><span class="toc-text">容错与断路保护</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%9B%9E%E9%80%80%E9%80%BB%E8%BE%91"><span class="toc-text">自定义回退逻辑</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95-1"><span class="toc-text">测试</span></a></li></ol></li></ol></div></div></div><div class="row"><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1 sidebar-container"><div style="margin-top:20px"><h5 class="text-center">FRIENDS</h5><ul class="list-inline text-center"><li><a target="_blank" rel="noopener" href="https://springcloud.cc/">Spring Cloud中文网</a></li><li><a target="_blank" rel="noopener" href="http://www.spring4all.com/">Spring For All</a></li><li><a target="_blank" rel="noopener" href="https://github.com/spring-cloud">Spring Cloud</a></li></ul></div></div></div></div></article><footer><div class="container"><div class="row"><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1 text-center"><br><ul class="list-inline text-center"><li><a target="_blank" href="https://www.zhihu.com/people/huluohu"><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-stack-1x fa-inverse">知</i></span></a></li><li><a target="_blank" href="https://github.com/fooololo"><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-github fa-stack-1x fa-inverse"></i></span></a></li></ul><p class="copyright text-muted">Copyright &copy; 胡萝虎 2021 浙ICP备18019084号-1<br><span id="busuanzi_container_site_pv" style="font-size:12px">访问: <span id="busuanzi_value_site_pv"></span> 次</span> <span class="post-meta-divider">|</span> <span id="busuanzi_container_site_uv" style="font-size:12px;display:none">访客：<span id="busuanzi_value_site_uv"></span>人</span><br></p></div></div></div></footer><script src="/js/jquery.min.js"></script><script src="/js/bootstrap.min.js"></script><script src="/js/blog.js"></script><script>function async(e,n){var t=document,a="script",r=t.createElement(a),a=t.getElementsByTagName(a)[0];r.src=e,n&&r.addEventListener("load",function(e){n(null,e)},!1),a.parentNode.insertBefore(r,a)}</script><script>0!==$("#tag_cloud").length&&async("https://huluohu.com/js/jquery.tagcloud.js",function(){$.fn.tagcloud.defaults={color:{start:"#bbbbee",end:"#0085a1"}},$("#tag_cloud a").tagcloud()})</script><script>async("//cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js",function(){var c=document.querySelector("nav");c&&FastClick.attach(c)})</script><script>var _baId="a56cc9c749e8c4177e393ae19735216f",_hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="//hm.baidu.com/hm.js?"+_baId;var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><script type="text/javascript">!function(t,e,n,s,c,i){t.SwiftypeObject=s,t[s]=t[s]||function(){(t[s].q=t[s].q||[]).push(arguments)},c=e.createElement(n),i=e.getElementsByTagName(n)[0],c.async=1,c.src="//s.swiftypecdn.com/install/v2/st.js",i.parentNode.insertBefore(c,i)}(window,document,"script","_st"),_st("install","","2.0.0")</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><img class="wechat-title-img" src="/img/avatar.png"><script>"serviceWorker"in navigator&&navigator.serviceWorker.register("/sw.js?t=1610684394200").then(function(){console.log("ServiceWorker Register Successfully.")}).catch(function(e){console.error(e)})</script><script>window.imageLazyLoadSetting={isSPA:!1,processImages:null}</script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(e.href.match(t)||e.href.match(r))&&(e.href=a.dataset.original)})})</script><script>!function(n){n.imageLazyLoadSetting.processImages=i;var e=n.imageLazyLoadSetting.isSPA,r=Array.prototype.slice.call(document.querySelectorAll("img[data-original]"));function i(){e&&(r=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")));for(var t,a=0;a<r.length;a++)0<=(t=(t=r[a]).getBoundingClientRect()).bottom&&0<=t.left&&t.top<=(n.innerHeight||document.documentElement.clientHeight)&&function(){var e=r[a],t=e,n=function(){r=r.filter(function(t){return e!==t})},i=new Image,o=t.getAttribute("data-original");i.onload=function(){t.src=o,n()},i.src=o}()}i(),n.addEventListener("scroll",function(){var t=i,e=n;clearTimeout(t.tId),t.tId=setTimeout(function(){t.call(e)},500)})}(this)</script></body></html>