<!DOCTYPE html><html lang="en"><head><link rel="manifest" href="/manifest.json"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="胡萝虎的个人博客"><meta name="keywords" content="Config,Disconf,Spring Cloud,胡萝虎,coding,github,"><meta name="theme-color" content="#600090"><meta name="msapplication-navbutton-color" content="#600090"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#600090"><meta name="google-site-verification" content="Fopvra9wVSD0vPGoK0_S3WC-WOIXGozNTIGw9u9fUwE"><link rel="shortcut icon" href="/favicon.ico"><link rel="alternate" type="application/atom+xml" title="胡萝虎" href="/atom.xml"><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.2/animate.min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.css"><link rel="apple-touch-icon" href="/img/touch/avatar_220.jpeg"><link rel="apple-touch-icon" href="/img/touch/avatar_220.jpeg"><title>SpringCloud系列之Config｜胡萝虎的博客</title><link rel="canonical" href="https://huluohu.com/2018/04/28/SpringCloud系统之Config/"><link rel="stylesheet" href="/css/bootstrap.min.css"><link rel="stylesheet" href="/css/blog-style.css"><link rel="stylesheet" href="/css/syntax.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.5.1/katex.min.css"><meta name="generator" content="Hexo 5.3.0"></head><style>header.intro-header{background-image:url(/img/avatarbg.jpg)}</style><body ontouchstart="" class="animated fadeIn"><nav class="navbar navbar-default navbar-custom navbar-fixed-top" id="nav-top" data-ispost="true" data-istags="false
" data-ishome="false"><div class="container-fluid"><div class="navbar-header page-scroll"><button type="button" class="navbar-toggle"><span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span></button> <a class="navbar-brand animated pulse" href="/"><span class="brand-logo">胡萝虎 </span>Blog</a></div><div id="huxblog_navbar"><div class="navbar-collapse"><ul class="nav navbar-nav navbar-right"><li><a href="/">Home</a></li><li><a href="/archive/">archive</a></li><li><a href="/tags/">tags</a></li><li><a href="/about">About</a></li></ul></div></div></div></nav><script>var $toggle=document.querySelector(".navbar-toggle"),$navbar=document.querySelector("#huxblog_navbar"),$collapse=document.querySelector(".navbar-collapse");function handleMagic(e){0<$navbar.className.indexOf("in")?($navbar.className=" ",setTimeout(function(){$navbar.className.indexOf("in")<0&&($collapse.style.height="0px")},400)):($collapse.style.height="auto",$navbar.className+=" in")}$toggle.addEventListener("click",handleMagic)</script><img class="wechat-title-img" src="undefinedconfig01.png"><style>header.intro-header{background-image:url(undefinedconfig01.png?imageView2/1/w/1400/h/400/interlace/1/q/90)}</style><header class="intro-header"><div class="container"><div class="row"><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1 text-center"><div class="post-heading"><h1>SpringCloud系列之Config</h1><span class="meta">作者 胡萝虎 <span>日期 2018-04-28</span></span><div class="tags text-center"><a class="tag" href="/tags/#Spring Cloud" title="Spring Cloud">Spring Cloud</a> <a class="tag" href="/tags/#Spring Boot" title="Spring Boot">Spring Boot</a> <a class="tag" href="/tags/#Spring" title="Spring">Spring</a> <a class="tag" href="/tags/#微服务" title="微服务">微服务</a> <a class="tag" href="/tags/#集群" title="集群">集群</a> <a class="tag" href="/tags/#Config" title="Config">Config</a></div></div></div></div></div><div class="post-title-haojen"><span>SpringCloud系列之Config</span></div></header><article><div class="container"><div class="row"><div class="col-lg-8 col-lg-offset-1 col-sm-9 post-container"><blockquote><p>相对于单体应用，微服务架构下的应用粒度小、部署实例的量级和复杂度大大增加。这时候，应用的配置如果还是和应用打包在一起部署，势必会造成维护和变更困难，难以支持业务的快速变化。因而，有必对配置进行集中化管理，以利于持续的维护。目前，比较成熟的集中式配置管理方案有几种，如Disconf、Diamond、Apollo，以及直接使用Zookeeper、Consul等中间件。在Spring Cloud技术栈中，官方为我们提供了一个新的选择：Spring Cloud Config。</p></blockquote><h2 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h2><p>Spring Cloud Config由Config Server和Config Client组成，前者用于对配置数据进行管理，后者用于获取配置及处理配置变更。Config Server支持横向扩展，默认支持Git存储配置数据（也支持SVN和文件存储）。下面以Git作为存储方式来详细介绍。</p><div id="sequence-0"></div><p>​ <strong>Spring Cloud Config配置获取时序图</strong></p><h4 id="创建Git-Repo"><a href="#创建Git-Repo" class="headerlink" title="创建Git Repo"></a>创建Git Repo</h4><p>创建一个Git Repository，读者可以使用Github、Coding或自己搭建Gitlib等方式，很简单，这里就不再赘述。</p><h4 id="准备配置文件"><a href="#准备配置文件" class="headerlink" title="准备配置文件"></a>准备配置文件</h4><p>创建完Repository后，再创建config-example目录，如下图所示：</p><p><img src="/images/loading.gif" data-original="https://tva1.sinaimg.cn/large/006tNc79gy1fqslbm05mrj31kw0ml0xn.jpg" alt="创建应用目录"></p><p>然后再创建文件application-local.properties和application-test.properties，如下图</p><p><img src="/images/loading.gif" data-original="https://tva1.sinaimg.cn/large/006tNc79gy1fqslbnunf6j31kw0h4gq1.jpg" alt="创建应用配置"></p><p>application-local.preperties内容：</p><figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="meta">fooololo.host</span>=<span class="string">local.huluohu.com</span></span><br><span class="line"><span class="meta">fooololo.username</span>=<span class="string">local</span></span><br><span class="line"><span class="meta">fooololo.password</span>=<span class="string">123</span></span><br></pre></td></tr></table></figure><p>application-test.properties内容：</p><figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="meta">fooololo.host</span>=<span class="string">test.huluohu.com</span></span><br><span class="line"><span class="meta">fooololo.username</span>=<span class="string">test</span></span><br><span class="line"><span class="meta">fooololo.password</span>=<span class="string">123</span></span><br></pre></td></tr></table></figure><h2 id="搭建ConfigServer"><a href="#搭建ConfigServer" class="headerlink" title="搭建ConfigServer"></a>搭建ConfigServer</h2><h4 id="创建Maven工程"><a href="#创建Maven工程" class="headerlink" title="创建Maven工程"></a>创建Maven工程</h4><p><img src="/images/loading.gif" data-original="https://tva1.sinaimg.cn/large/006tNc79gy1fqslbmzbcbj30js0gg75l.jpg" alt="创建ConfigServer工程"></p><h4 id="添加依赖"><a href="#添加依赖" class="headerlink" title="添加依赖"></a>添加依赖</h4><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-config-server<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="创建启动类"><a href="#创建启动类" class="headerlink" title="创建启动类"></a>创建启动类</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.huluohu.cloud.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.config.server.EnableConfigServer;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableConfigServer</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConfigServer</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(ConfigServer.class,args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="添加应用配置"><a href="#添加应用配置" class="headerlink" title="添加应用配置"></a>添加应用配置</h4><p>在src/main/resources目录下创建bootstrap.yml，内容如下</p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">      <span class="attr">config:</span></span><br><span class="line">        <span class="attr">server:</span></span><br><span class="line">          <span class="attr">bootstrap:</span> <span class="literal">true</span></span><br><span class="line">          <span class="attr">git:</span></span><br><span class="line">            <span class="attr">uri:</span> <span class="string">https://github.com/fooololo/spring-cloud-config-repo</span></span><br><span class="line">            <span class="attr">username:</span> <span class="comment">#git仓库的账号</span></span><br><span class="line">            <span class="attr">password:</span> <span class="comment">#git仓库的密码</span></span><br><span class="line">            <span class="attr">search-paths:</span> <span class="string">&#x27;&#123;application&#125;&#x27;</span>  <span class="comment">#  根据application的名称搜索目录</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>其中spring.cloud.config.server.git为上面创建的Git Repository的URL，username和password为你的Git账户名和密码。</p><p>在src/main/resources目录下创建application.yml，内容如下：</p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">config-server</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8888</span></span><br></pre></td></tr></table></figure><h4 id="启动并测试Config-Server"><a href="#启动并测试Config-Server" class="headerlink" title="启动并测试Config Server"></a>启动并测试Config Server</h4><p>在浏览器中输入：<code>http://localhost:8888/config-example/local/</code></p><p>返回的是config-example目录下application-local.properties配置文件中的内容</p><p><img src="/images/loading.gif" data-original="https://tva1.sinaimg.cn/large/006tNc79gy1fqslblixp6j31ko0qsn21.jpg" alt="local环境配置"></p><p>在浏览器中输入：<code>http://localhost:8888/config-example/test/</code></p><p>返回的是config-example目录下application-testp.roperties配置文件中的内容</p><p><img src="/images/loading.gif" data-original="https://tva1.sinaimg.cn/large/006tNc79gy1fqslbkp2ugj31hq0r4gpq.jpg" alt="test环境配置"></p><h2 id="创建ConfigClient-应用"><a href="#创建ConfigClient-应用" class="headerlink" title="创建ConfigClient 应用"></a>创建ConfigClient 应用</h2><h4 id="创建Maven工程-1"><a href="#创建Maven工程-1" class="headerlink" title="创建Maven工程"></a>创建Maven工程</h4><p><img src="/images/loading.gif" data-original="https://tva1.sinaimg.cn/large/006tKfTcgy1fqx21q76m7j30hm0eiq3s.jpg" alt="image-20180502141827430"></p><h4 id="添加依赖-1"><a href="#添加依赖-1" class="headerlink" title="添加依赖"></a>添加依赖</h4><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-config<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.retry<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-retry<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-aop<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="创建启动类-1"><a href="#创建启动类-1" class="headerlink" title="创建启动类"></a>创建启动类</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.huluohu.cloud.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConfigClientApplication</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(ConfigClientApplication.class,args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="添加应用配置-1"><a href="#添加应用配置-1" class="headerlink" title="添加应用配置"></a>添加应用配置</h4><h5 id="bootstarp"><a href="#bootstarp" class="headerlink" title="bootstarp"></a>bootstarp</h5><p>在src/main/resources目录下创建bootstrap.yml，内容如下</p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">config-example</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">      <span class="attr">config:</span></span><br><span class="line">        <span class="attr">uri:</span> <span class="string">http://localhost:8888</span> <span class="comment"># 配置服务器地址</span></span><br><span class="line">        <span class="attr">fail-fast:</span> <span class="literal">true</span> <span class="comment"># 快速失败</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">$&#123;spring.application.name&#125;</span> <span class="comment">#默认就是spring.application.name</span></span><br><span class="line">        <span class="attr">profile:</span> <span class="string">$&#123;spring.profiles.active:default&#125;</span> <span class="comment"># 默认就是spring.profiles.active</span></span><br><span class="line">        <span class="attr">label:</span> <span class="string">master</span> <span class="comment">#标签</span></span><br><span class="line">        <span class="attr">retry:</span></span><br><span class="line">          <span class="attr">max-attempts:</span> <span class="number">6</span> <span class="comment">#最大重试次数</span></span><br><span class="line">          <span class="attr">max-interval:</span> <span class="number">2000</span> <span class="comment">#间隔时间</span></span><br></pre></td></tr></table></figure><p><code>spring.cloud.config.url</code>配置的是上面我们搭建的Config Server的地址</p><p>其他参数默认可以不单独配置，其中重试和快速失败等配置不是必须的。</p><h5 id="应用配置"><a href="#应用配置" class="headerlink" title="应用配置"></a>应用配置</h5><p>在src/main/resources目录下创建application.yml，内容如下</p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8088</span></span><br></pre></td></tr></table></figure><h4 id="编写测试代码"><a href="#编写测试代码" class="headerlink" title="编写测试代码"></a>编写测试代码</h4><p>编写一个controller，用来测试读取远程配置（也可以直接使用Junit进行测试），代码如下</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.huluohu.cloud.config.web;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.ResponseEntity;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/test&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestController</span> </span>&#123;</span><br><span class="line">    <span class="comment">//远程配置的key</span></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;fooololo.host&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String host;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//远程配置的key</span></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;fooololo.password&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//远程配置的key</span></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;fooololo.username&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String userName;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/config&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;Map&lt;String, String&gt;&gt; testConfig() &#123;</span><br><span class="line">        Map&lt;String, String&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;(<span class="number">3</span>);</span><br><span class="line">        map.put(<span class="string">&quot;host&quot;</span>, host);</span><br><span class="line">        map.put(<span class="string">&quot;userName&quot;</span>, userName);</span><br><span class="line">        map.put(<span class="string">&quot;password&quot;</span>, password);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(map);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="启动测试应用"><a href="#启动测试应用" class="headerlink" title="启动测试应用"></a>启动测试应用</h5><p><img src="/images/loading.gif" data-original="https://tva1.sinaimg.cn/large/006tKfTcgy1fqx21s29hcj31kw0kfn1h.jpg" alt="image-20180502142744596"></p><p>分别使用local和test profile启动应用，然后在浏览器中访问<code>http://localhost:8088/test/config</code></p><p><img src="/images/loading.gif" data-original="https://tva1.sinaimg.cn/large/006tKfTcgy1fqx21qu84oj31kw0cpqc8.jpg" alt="image-20180502143131562"></p><p><strong>启动的时候可以看到应用会先从远处服务器拉取配置</strong></p><h5 id="local-profile的结果"><a href="#local-profile的结果" class="headerlink" title="local profile的结果"></a>local profile的结果</h5><p><img src="/images/loading.gif" data-original="https://tva1.sinaimg.cn/large/006tKfTcgy1fqx21rewabj30xk0de0tp.jpg" alt="image-20180502143017837"></p><h5 id="test-profile的结果"><a href="#test-profile的结果" class="headerlink" title="test profile的结果"></a>test profile的结果</h5><p><img src="/images/loading.gif" data-original="https://tva1.sinaimg.cn/large/006tKfTcgy1fqx21nua6tj30yo0c8gmk.jpg" alt="image-20180502143252735"></p><h2 id="刷新配置"><a href="#刷新配置" class="headerlink" title="刷新配置"></a>刷新配置</h2><p>应用发布上线以后，现在需要修改一个配置参数，例如将<code>fooololo.password</code>修改为<code>456</code>,这时候应该如何让修改生效呢？</p><h4 id="增加依赖"><a href="#增加依赖" class="headerlink" title="增加依赖"></a>增加依赖</h4><p>在Config Client应用中增加以下依赖：</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span>  </span><br></pre></td></tr></table></figure><h4 id="增加刷新注解"><a href="#增加刷新注解" class="headerlink" title="增加刷新注解"></a>增加刷新注解</h4><p>在TestController类上增加<code>@RefreshScope</code>注解，表示该类中使用<code>@Value</code>注解的配置项可能动态刷新</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RefreshScope</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/test&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;fooololo.host&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String host;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;fooololo.password&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;fooololo.username&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String userName;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/config&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;Map&lt;String, String&gt;&gt; testConfig() &#123;</span><br><span class="line">        Map&lt;String, String&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;(<span class="number">3</span>);</span><br><span class="line">        map.put(<span class="string">&quot;host&quot;</span>, host);</span><br><span class="line">        map.put(<span class="string">&quot;userName&quot;</span>, userName);</span><br><span class="line">        map.put(<span class="string">&quot;password&quot;</span>, password);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(map);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="修改配置"><a href="#修改配置" class="headerlink" title="修改配置"></a>修改配置</h4><p>在application.yml中增加以下配置：</p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">management:</span></span><br><span class="line">  <span class="attr">security:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure><h4 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h4><ul><li>首先重启Config Client（以local profile为例）应用，即config-example，这时候访问<code>http://localhost:8088/test/config</code>获得<code>password=123</code></li><li>接着修改spring-cloud-config-repo仓库中config-example目录下application-local.properties中的<code>fooololo.password=456</code></li><li>然后使用Postman或其他工具，向<code>http://localhost:8088/refresh</code>发送一个POST请求</li><li>最后再重新访问<code>http://localhost:8088/test/config</code>，可以看到<code>password</code>的值已经为<code>456</code>了</li></ul><p>Spring Cloud Config的简单配置已经介绍完了，在实际生产环境中，可能会需要更复杂的设置，读者可以在此基础上继续探索，找到适合自己的最佳实践！</p><script src="https://cdn.bootcss.com/webfont/1.6.28/webfontloader.js"></script><script src="https://cdn.bootcss.com/raphael/2.2.7/raphael.min.js"></script><script src="https://cdn.bootcss.com/underscore.js/1.8.3/underscore-min.js"></script><script src="https://cdn.bootcss.com/js-sequence-diagrams/1.0.6/sequence-diagram-min.js"></script><textarea id="sequence-0-code" style="display:none">Config Client->Config Server: 获取配置
Config Server-> Git Repo: 拉取配置数据
Git Repo-->Config Server: 返回配置数据
Config Server->Config Server: 缓存配置数据
Config Server-->Config Client: 响应配置</textarea><textarea id="sequence-0-options" style="display:none">{"theme":"simple"}</textarea><script>var code=document.getElementById("sequence-0-code").value,options=JSON.parse(decodeURIComponent(document.getElementById("sequence-0-options").value)),diagram=Diagram.parse(code);diagram.drawSVG("sequence-0",options)</script><div style="width:100%;height:30px;line-height:30px;text-align:center;background:#f5f5f5"><span>没有更多了^ - ^</span></div><div style="width:100%;height:340px;text-align:center"></div><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAKQAAACkCAAAAAA83tqdAAACfElEQVR42u2by3aDQAxD+f+fppsu0mRsXQ85XYzEJo8SuHDGRpbd62q2+3d7ff/6+XU/9bvV+/fvtrZAHgl5L7YOsgLuXtWFdByB9IR8P0D3/fQCqsCoLmrJFchANgu6C4oV0Gqf7piBDOQUshIZKlhoAAUykJOFXIkFEiAqiW+roEAeB9nVPv/5ul0tBvIoyFts6iBKYBBxIhkCaQWpHvxYlBYnp4aAvAGBtIFUBRIVvEowT39zKVcikEdDdkXUxJSnIrmDX/4tkFaQZF1OGkg0gXciZblvIG0gVTFODFVyMpXY22IskFaQJFFTMdCdWD0gxhMCgTwWUiXbqQgmjVFirP75PpBWkJ0hT5I3aXoSw0o+XAJpA0kFKQkwlXfVzSgfCIG0guwWPlnck0YVudiygR9IO0g6vEmHQybFnTLKAukLSZIsHeB8GkCBDCQ155+IisqsHTflA2kHSQfaJgU+aWihSapAWkDuGE7EtCfFP23oB9ILkjbNKbwSvl2CH1eLgTwOcqfpSQVHV5jRZsHHQF0grSDVglYnmpqw1HgIpBckAZ0UWCTJE0GCCrFAHgnZBYgaDtkRxGTw7iNIA2kFOZkbIoZC9yDYLdoC6QupjCt1ICpAiLlQ3sVAWkB2yfoJ/M4ActloCKQdpCrQiQlATCsihEtlHkg7yO5HSpUoM5WIllbcBNIGcmRmikKNmqU0AGVkB/JISLJwifn0zUGlUcM+kEdCKtOJNjqJ4TVpTgXSG5I0QIn5r+BUEJaFWiADKYTDpJFPDYP2ogMZyEv/szhN/igwVFEXSDtIUoCRoeHJcNJoiDmQVpB0SJ4mblLcd8XXyNgK5GmQP5TybIu7VSe4AAAAAElFTkSuQmCC"><div style="width:100%;text-align:center"><span style="font-size:20px">“扫一扫接着看”</span></div><ul class="pager"><li class="previous"><a href="/2018/05/07/SpringCloud系统之Config自动刷新/" data-toggle="tooltip" data-placement="top" title="SpringCloud系列之Config自动刷新">&larr; Previous Post</a></li><li class="next"><a href="/2018/04/27/鲜春/" data-toggle="tooltip" data-placement="top" title="鲜春">Next Post &rarr;</a></li></ul><div id="lv-container" data-id="city" data-uid="MTAyMC8zNTY2My8xMjE5OQ=="><script type="text/javascript">!function(e,t){var n=e.getElementsByTagName(t)[0];"function"!=typeof LivereTower&&((t=e.createElement(t)).src="https://cdn-city.livere.com/js/embed.dist.js",t.async=!0,n.parentNode.insertBefore(t,n))}(document,"script")</script><noscript>为正常使用来必力评论功能请激活JavaScript</noscript></div></div><div class="hidden-xs col-sm-3 toc-col"><div class="toc-wrap"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%86%E5%A4%87"><span class="toc-text">准备</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BAGit-Repo"><span class="toc-text">创建Git Repo</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%87%86%E5%A4%87%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-text">准备配置文件</span></a></li></ol></li></ol><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%90%AD%E5%BB%BAConfigServer"><span class="toc-text">搭建ConfigServer</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BAMaven%E5%B7%A5%E7%A8%8B"><span class="toc-text">创建Maven工程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E4%BE%9D%E8%B5%96"><span class="toc-text">添加依赖</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%90%AF%E5%8A%A8%E7%B1%BB"><span class="toc-text">创建启动类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E5%BA%94%E7%94%A8%E9%85%8D%E7%BD%AE"><span class="toc-text">添加应用配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8%E5%B9%B6%E6%B5%8B%E8%AF%95Config-Server"><span class="toc-text">启动并测试Config Server</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BAConfigClient-%E5%BA%94%E7%94%A8"><span class="toc-text">创建ConfigClient 应用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BAMaven%E5%B7%A5%E7%A8%8B-1"><span class="toc-text">创建Maven工程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E4%BE%9D%E8%B5%96-1"><span class="toc-text">添加依赖</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%90%AF%E5%8A%A8%E7%B1%BB-1"><span class="toc-text">创建启动类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E5%BA%94%E7%94%A8%E9%85%8D%E7%BD%AE-1"><span class="toc-text">添加应用配置</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#bootstarp"><span class="toc-text">bootstarp</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E9%85%8D%E7%BD%AE"><span class="toc-text">应用配置</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%96%E5%86%99%E6%B5%8B%E8%AF%95%E4%BB%A3%E7%A0%81"><span class="toc-text">编写测试代码</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8%E6%B5%8B%E8%AF%95%E5%BA%94%E7%94%A8"><span class="toc-text">启动测试应用</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#local-profile%E7%9A%84%E7%BB%93%E6%9E%9C"><span class="toc-text">local profile的结果</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#test-profile%E7%9A%84%E7%BB%93%E6%9E%9C"><span class="toc-text">test profile的结果</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%B7%E6%96%B0%E9%85%8D%E7%BD%AE"><span class="toc-text">刷新配置</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A2%9E%E5%8A%A0%E4%BE%9D%E8%B5%96"><span class="toc-text">增加依赖</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A2%9E%E5%8A%A0%E5%88%B7%E6%96%B0%E6%B3%A8%E8%A7%A3"><span class="toc-text">增加刷新注解</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E9%85%8D%E7%BD%AE"><span class="toc-text">修改配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95"><span class="toc-text">测试</span></a></li></ol></li></div></div></div><div class="row"><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1 sidebar-container"><div style="margin-top:20px"><h5 class="text-center">FRIENDS</h5><ul class="list-inline text-center"><li><a target="_blank" rel="noopener" href="https://springcloud.cc/">Spring Cloud中文网</a></li><li><a target="_blank" rel="noopener" href="http://www.spring4all.com/">Spring For All</a></li><li><a target="_blank" rel="noopener" href="https://github.com/spring-cloud">Spring Cloud</a></li></ul></div></div></div></div></article><footer><div class="container"><div class="row"><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1 text-center"><br><ul class="list-inline text-center"><li><a target="_blank" href="https://www.zhihu.com/people/huluohu"><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-stack-1x fa-inverse">知</i></span></a></li><li><a target="_blank" href="https://github.com/fooololo"><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-github fa-stack-1x fa-inverse"></i></span></a></li></ul><p class="copyright text-muted">Copyright &copy; 胡萝虎 2021 浙ICP备18019084号-1<br><span id="busuanzi_container_site_pv" style="font-size:12px">访问: <span id="busuanzi_value_site_pv"></span> 次</span> <span class="post-meta-divider">|</span> <span id="busuanzi_container_site_uv" style="font-size:12px;display:none">访客：<span id="busuanzi_value_site_uv"></span>人</span><br></p></div></div></div></footer><script src="/js/jquery.min.js"></script><script src="/js/bootstrap.min.js"></script><script src="/js/blog.js"></script><script>function async(e,n){var t=document,a="script",r=t.createElement(a),a=t.getElementsByTagName(a)[0];r.src=e,n&&r.addEventListener("load",function(e){n(null,e)},!1),a.parentNode.insertBefore(r,a)}</script><script>0!==$("#tag_cloud").length&&async("https://huluohu.com/js/jquery.tagcloud.js",function(){$.fn.tagcloud.defaults={color:{start:"#bbbbee",end:"#0085a1"}},$("#tag_cloud a").tagcloud()})</script><script>async("//cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js",function(){var c=document.querySelector("nav");c&&FastClick.attach(c)})</script><script>var _baId="a56cc9c749e8c4177e393ae19735216f",_hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="//hm.baidu.com/hm.js?"+_baId;var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><script type="text/javascript">!function(t,e,n,s,c,i){t.SwiftypeObject=s,t[s]=t[s]||function(){(t[s].q=t[s].q||[]).push(arguments)},c=e.createElement(n),i=e.getElementsByTagName(n)[0],c.async=1,c.src="//s.swiftypecdn.com/install/v2/st.js",i.parentNode.insertBefore(c,i)}(window,document,"script","_st"),_st("install","","2.0.0")</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><img class="wechat-title-img" src="/img/avatar.png"><script>"serviceWorker"in navigator&&navigator.serviceWorker.register("/sw.js?t=1610684148379").then(function(){console.log("ServiceWorker Register Successfully.")}).catch(function(e){console.error(e)})</script><script>
            window.imageLazyLoadSetting = {
                isSPA: false,
                processImages: null,
            };
        </script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(e.href.match(t)||e.href.match(r))&&(e.href=a.dataset.original)})});</script><script>!function(n){n.imageLazyLoadSetting.processImages=i;var e=n.imageLazyLoadSetting.isSPA,r=Array.prototype.slice.call(document.querySelectorAll("img[data-original]"));function i(){e&&(r=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")));for(var t,a=0;a<r.length;a++)0<=(t=(t=r[a]).getBoundingClientRect()).bottom&&0<=t.left&&t.top<=(n.innerHeight||document.documentElement.clientHeight)&&function(){var t,e,n,i,o=r[a];t=o,e=function(){r=r.filter(function(t){return o!==t})},n=new Image,i=t.getAttribute("data-original"),n.onload=function(){t.src=i,e&&e()},n.src=i}()}i(),n.addEventListener("scroll",function(){var t,e;t=i,e=n,clearTimeout(t.tId),t.tId=setTimeout(function(){t.call(e)},500)})}(this);</script></body></html>